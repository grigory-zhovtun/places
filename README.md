# Places (Django)

Открыть проект локально: после запуска перейдите на http://127.0.0.1:8000/

Небольшое Django‑приложение для отображения интересных мест на карте. Проект использует Leaflet, статические JSON‑данные и/или данные из БД. Есть админка для управления местами и фотографиями.

---

## Features

- Интерактивная карта с метками и боковой панелью
- Загрузка и отображение фотографий мест (медиа)
- Админ‑панель Django: управление местами и изображениями
- Поддержка визуального редактора описаний (`django-tinymce`)
- Сортировка изображений в админке (`django-admin-sortable2`)
- Раздача статики и медиа в dev‑режиме
- **Импорт мест из JSON**: команда `load_place` для загрузки данных о локациях из внешних JSON-файлов по URL  

---

## Prerequisites

- Python 3.10+  
- Установленный `pip`  
- Файл `requirements.txt` с зависимостями (в репозитории)  

---

## Installation and Setup

1. Клонируйте репозиторий  
   ```bash
   git clone <your-repository-url>
   cd <project-folder>
   ```

2. (Опционально) создайте и активируйте виртуальное окружение  
   ```bash
   python -m venv venv
   # Linux/macOS
   source venv/bin/activate
   # Windows
   venv\Scripts\activate
   ```

3. Установите зависимости  
   ```bash
   pip install -r requirements.txt
   ```

4. Создайте файл `.env` в корне проекта со значениями переменных окружения  
   ```env
   SECRET_KEY=your-secret-key
   DEBUG=True
   ALLOWED_HOSTS=127.0.0.1,localhost
   ```

5. Выполните миграции и (при необходимости) создайте суперпользователя  
   ```bash
   python manage.py migrate
   python manage.py createsuperuser
   ```

6. (Опционально) Загрузите места из JSON-файлов с помощью команды `load_place`
   ```bash
   # Загрузить место из JSON по URL
   python manage.py load_place <json_url>

   # Пример загрузки места из репозитория
   python manage.py load_place https://raw.githubusercontent.com/devmanorg/where-to-go-places/master/places/moscow_legends.json
   ```

7. Запустите сервер разработки
   ```bash
   python manage.py runserver
   ```

8. Откройте в браузере http://127.0.0.1:8000/
   Админ‑панель: http://127.0.0.1:8000/admin/

---

## Load Place Command

Команда `load_place` позволяет импортировать данные о местах из внешних JSON-файлов по URL. Это удобно для массового добавления локаций из внешних источников.

### Использование

```bash
python manage.py load_place <json_url>
```

### Формат JSON

JSON-файл должен содержать следующие обязательные поля:

```json
{
  "title": "Название места",
  "description_short": "Краткое описание",
  "description_long": "Подробное описание с HTML-разметкой",
  "coordinates": {
    "lng": 37.617635,
    "lat": 55.755814
  },
  "imgs": [
    "https://example.com/image1.jpg",
    "https://example.com/image2.jpg"
  ]
}
```

### Что делает команда

1. **Загружает JSON** по указанному URL
2. **Создаёт запись** в модели `Place` с основными данными
3. **Скачивает все изображения** из массива `imgs` и сохраняет их в модель `Image`
4. **Устанавливает правильную позицию** для каждого изображения (порядок как в массиве)
5. **Обрабатывает ошибки** и продолжает работу при проблемах с отдельными изображениями

### Особенности

- Если место с таким названием уже существует, команда пропустит создание
- Каждому изображению автоматически присваивается позиция для правильной сортировки
- Команда обрабатывает ошибки скачивания отдельных изображений, не прерывая весь процесс
- Поддерживается как HTTP, так и HTTPS протоколы

---

## Environment Variables

- `SECRET_KEY` — секретный ключ Django (обязателен)  
- `DEBUG` — режим отладки (`True`/`False`, по умолчанию `False`)  
- `ALLOWED_HOSTS` — список хостов, разделённых запятой (например, `127.0.0.1,localhost`)  

---
